# Experiment "I/O Wait Time"

# Overview
The aim of this experiment is measuring the amount of IO wait time and CPU utilization in each stage of different applications.

# Tools
The `mpstat` and `top` command line utilities in Linux were used to collect the data for I/O wait time and CPU utlization respectively.

# Scripts
#### `parse-mpstat-output.py`
parses the output of `mpstat` on each node in real-time, filters the relevant information and outputs a comma delimited csv string each second. It opens a socket connection (`127.0.0.1:12004`) to which the spark executor connects and notify the script when a stage has changed.

#### Arguments
* --executerId, -e: ID of the executor for which this script is running.
* --appName, -a: Name of the application
* --fileNameWithoutExtension, -f: Name of the output file without an extension

#### Output
 The resulting file will be located in "`RESULT_HOME`/`fileNameWithoutExtension`.mpstat"

=================================================================

#### `parse-mpstat-result.py`
 parses the files generated by `parse-mpstat-output.py` script, averages the results to produce the final result for different stages of the application.

#### Arguments
 * --inputFile, -i: Absolute path of the file generated by the `parse-mpstat-result.py` script.
 * --outputFile, -o: Absolute path of the output (file) of this script.

#### Output
The result is a comma delimited csv string for each stage of the application that is saved in the file specified by `outputFile` parameter. For instance, `RESULT_HOME/figure1_experiment[io_wait_time].csv`

=================================================================

#### `parse-top-output.py`
parses the output of `top` on each node in real-time, filters the relevant information and outputs a comma delimited csv string each second. It opens a socket connection (`127.0.0.1:12002`) to which the spark executor connects and notify the script when a stage has changed.

#### Arguments
* --executerId, -e: ID of the executor for which this script is running.
* --appName, -a: Name of the application
* --fileNameWithoutExtension, -f: Name of the output file without an extension

#### Output
 The resulting file will be located in "`RESULT_HOME`/`fileNameWithoutExtension`.top"

=================================================================

#### `parse-top-result.py`
parses the files generated by `parse-top-output.py` script, averages the results to produce the final result for different stages of the application.

#### Arguments
* --inputFile, -i: Absolute path of the file generated by the `parse-top-result.py` script.
* --outputFile, -o: Absolute path of the output (file) of this script.

#### Output
The result is a comma delimited csv string for each stage of the application that is saved in the file specified by `outputFile` parameter. For instance, `RESULT_HOME/figure1_experiment[cpu_utilization].csv`

=================================================================

#### `getCpuUsageForStage.py`
contains a utility function `getCpuUsageForStage(topFileName, appName, stageId)` which parses the files generated by `parse-top-result.py` (topFileName) and gives the average cpu utilization for a given stage of an application.

=================================================================

#### `plot-mpstat.py`
plots the final figure, based on the data file generated by the `parse-mpstat-result.py` and `parse-top-result.py` scripts.

#### Arguments
* --inputFile, -i: Absolute path of the file generated by the `parse-mpstat-result.py` script.
* --topFile, -t: Absolute path of the file generated by the `parse-top-result.py` script.
* --outputFile, -o: Absolute path of the output pdf file containing the figure.

# Requirements
* The `parse-mpstat-output.py` and `parse-top-output.py` scripts produce their logs under `$LOG_HOME/parseMpstatOutput.log` and `$LOG_HOME/parseTopOutput.log` respectively. Please set environment variable `$LOG_HOME` to your preferred location. For instance, `export LOG_HOME=/home/logs`

<!---
* Both scripts use the directory `/home/results` as well as `/home/results/mpstat` to persist the final output. Please make sure these directories exist in advance.
-->
